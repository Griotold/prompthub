# í”„ë¡¬í”„íŠ¸í—ˆë¸Œ(PromptHub) ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„

## ğŸ“Š ERD ê°œìš”
```
users (ì‚¬ìš©ì) 
  â†“ 1:N
prompts (í”„ë¡¬í”„íŠ¸)
  â†“ N:1
categories (ì¹´í…Œê³ ë¦¬)

users â†â†’ prompts (N:M) via prompt_likes (ì¢‹ì•„ìš”)
users â†â†’ prompts (N:M) via prompt_bookmarks (ë¶ë§ˆí¬)
prompts â†â†’ tags (N:M) via prompt_tags (íƒœê·¸)
```

## ğŸ—ƒï¸ í…Œì´ë¸” ìƒì„¸ ì„¤ê³„

### 1. users (ì‚¬ìš©ì í…Œì´ë¸”)
```sql
CREATE TABLE users (
    id BIGSERIAL PRIMARY KEY,
    email VARCHAR(100) UNIQUE NOT NULL,
    nickname VARCHAR(100) NOT NULL,
    password_hash VARCHAR(200) NOT NULL,
    role VARCHAR(50) NOT NULL,
    status VARCHAR(50) NOT NULL,
    email_verified BOOLEAN NOT NULL DEFAULT false,
    registered_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    deactivated_at TIMESTAMP
);
```

**ì¸ë±ìŠ¤:**
- `idx_users_email` on (email)
- `idx_users_nickname` on (nickname)
- `idx_users_status` on (status)

**êµ¬í˜„ëœ ë„ë©”ì¸ ëª¨ë¸:**
- `Member.java` - íšŒì› ì§‘í•©ê·¼ (Aggregate Root)
- `Email.java` - ì´ë©”ì¼ ê°’ ê°ì²´ (Value Object)  
- `Role.java` - USER, ADMIN
- `MemberStatus.java` - ACTIVE, DEACTIVATED

### 2. categories (ì¹´í…Œê³ ë¦¬ í…Œì´ë¸”)
```sql
CREATE TABLE categories (
    id BIGSERIAL PRIMARY KEY,
    name VARCHAR(50) UNIQUE NOT NULL,
    description TEXT,
    color VARCHAR(7), -- HEX ìƒ‰ìƒì½”ë“œ
    icon VARCHAR(50), -- ì•„ì´ì½˜ ì´ë¦„
    sort_order INTEGER DEFAULT 0,
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

**ì´ˆê¸° ë°ì´í„°:**
- ChatGPT, Claude, Midjourney, Stable Diffusion, ì—…ë¬´ ìë™í™”, ì½˜í…ì¸  ìƒì„±, êµìœ¡, ê¸°íƒ€

### 3. prompts (í”„ë¡¬í”„íŠ¸ í…Œì´ë¸”)
```sql
CREATE TABLE prompts (
    id BIGSERIAL PRIMARY KEY,
    title VARCHAR(200) NOT NULL,
    content TEXT NOT NULL,
    description TEXT,
    user_id BIGINT REFERENCES users(id) ON DELETE CASCADE,
    category_id BIGINT REFERENCES categories(id) ON DELETE SET NULL,
    
    -- í†µê³„ ì •ë³´
    likes_count INTEGER DEFAULT 0,
    bookmarks_count INTEGER DEFAULT 0,
    views_count INTEGER DEFAULT 0,
    
    -- í”„ë¡¬í”„íŠ¸ ë©”íƒ€ë°ì´í„°
    input_example TEXT,
    output_example TEXT,
    use_case TEXT,
    limitations TEXT,
    
    -- ìƒíƒœ ê´€ë¦¬
    is_public BOOLEAN DEFAULT true,
    is_featured BOOLEAN DEFAULT false,
    status VARCHAR(20) DEFAULT 'ACTIVE', -- ACTIVE, INACTIVE, DELETED
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

**ì¸ë±ìŠ¤:**
- `idx_prompts_user_id` on (user_id)
- `idx_prompts_category_id` on (category_id)
- `idx_prompts_created_at` on (created_at DESC)
- `idx_prompts_likes_count` on (likes_count DESC)
- `idx_prompts_status` on (status)

### 4. tags (íƒœê·¸ í…Œì´ë¸”)
```sql
CREATE TABLE tags (
    id BIGSERIAL PRIMARY KEY,
    name VARCHAR(50) UNIQUE NOT NULL,
    usage_count INTEGER DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

**ì¸ë±ìŠ¤:**
- `idx_tags_name` on (name)
- `idx_tags_usage_count` on (usage_count DESC)

### 5. prompt_tags (í”„ë¡¬í”„íŠ¸-íƒœê·¸ ë§¤í•‘ í…Œì´ë¸”)
```sql
CREATE TABLE prompt_tags (
    prompt_id BIGINT REFERENCES prompts(id) ON DELETE CASCADE,
    tag_id BIGINT REFERENCES tags(id) ON DELETE CASCADE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (prompt_id, tag_id)
);
```

### 6. prompt_likes (í”„ë¡¬í”„íŠ¸ ì¢‹ì•„ìš” í…Œì´ë¸”)
```sql
CREATE TABLE prompt_likes (
    user_id BIGINT REFERENCES users(id) ON DELETE CASCADE,
    prompt_id BIGINT REFERENCES prompts(id) ON DELETE CASCADE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (user_id, prompt_id)
);
```

**ì¸ë±ìŠ¤:**
- `idx_prompt_likes_prompt_id` on (prompt_id)

### 7. prompt_bookmarks (í”„ë¡¬í”„íŠ¸ ë¶ë§ˆí¬ í…Œì´ë¸”)
```sql
CREATE TABLE prompt_bookmarks (
    user_id BIGINT REFERENCES users(id) ON DELETE CASCADE,
    prompt_id BIGINT REFERENCES prompts(id) ON DELETE CASCADE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (user_id, prompt_id)
);
```

**ì¸ë±ìŠ¤:**
- `idx_prompt_bookmarks_user_id` on (user_id)
- `idx_prompt_bookmarks_prompt_id` on (prompt_id)

## ğŸ”„ íŠ¸ë¦¬ê±° ì„¤ê³„

### ì¢‹ì•„ìš” ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸ íŠ¸ë¦¬ê±°
```sql
-- ì¢‹ì•„ìš” ì¶”ê°€/ì‚­ì œì‹œ prompts.likes_count ìë™ ì—…ë°ì´íŠ¸
CREATE OR REPLACE FUNCTION update_prompt_likes_count()
RETURNS TRIGGER AS $$
BEGIN
    IF TG_OP = 'INSERT' THEN
        UPDATE prompts SET likes_count = likes_count + 1 WHERE id = NEW.prompt_id;
        RETURN NEW;
    ELSIF TG_OP = 'DELETE' THEN
        UPDATE prompts SET likes_count = likes_count - 1 WHERE id = OLD.prompt_id;
        RETURN OLD;
    END IF;
    RETURN NULL;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trigger_update_prompt_likes_count
    AFTER INSERT OR DELETE ON prompt_likes
    FOR EACH ROW
    EXECUTE FUNCTION update_prompt_likes_count();
```

### íƒœê·¸ ì‚¬ìš©ëŸ‰ ì—…ë°ì´íŠ¸ íŠ¸ë¦¬ê±°
```sql
-- íƒœê·¸ ì¶”ê°€/ì‚­ì œì‹œ tags.usage_count ìë™ ì—…ë°ì´íŠ¸
CREATE OR REPLACE FUNCTION update_tag_usage_count()
RETURNS TRIGGER AS $$
BEGIN
    IF TG_OP = 'INSERT' THEN
        UPDATE tags SET usage_count = usage_count + 1 WHERE id = NEW.tag_id;
        RETURN NEW;
    ELSIF TG_OP = 'DELETE' THEN
        UPDATE tags SET usage_count = usage_count - 1 WHERE id = OLD.tag_id;
        RETURN OLD;
    END IF;
    RETURN NULL;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trigger_update_tag_usage_count
    AFTER INSERT OR DELETE ON prompt_tags
    FOR EACH ROW
    EXECUTE FUNCTION update_tag_usage_count();
```

## ğŸ“ˆ ì„±ëŠ¥ ìµœì í™”

### ì¸ë±ìŠ¤ ì „ëµ
1. **ë³µí•© ì¸ë±ìŠ¤**: (status, created_at), (category_id, created_at)
2. **ë¶€ë¶„ ì¸ë±ìŠ¤**: is_public = trueì¸ ë°ì´í„°ë§Œ
3. **ì „ë¬¸ ê²€ìƒ‰**: title, contentì— ëŒ€í•œ GIN ì¸ë±ìŠ¤

### íŒŒí‹°ì…”ë‹ ê³ ë ¤ì‚¬í•­
- prompts í…Œì´ë¸”ì´ ì»¤ì§€ë©´ created_at ê¸°ì¤€ ì›”ë³„ íŒŒí‹°ì…”ë‹
- ë¡œê·¸ì„± ë°ì´í„°ëŠ” ë³„ë„ í…Œì´ë¸”ë¡œ ë¶„ë¦¬

## ğŸ¯ MVP êµ¬í˜„ í˜„í™©

### Phase 1 (Current - êµ¬í˜„ ì¤‘)
1. âœ… **users (Member ë„ë©”ì¸ ì™„ë£Œ)**
   - Member ì—”í‹°í‹° êµ¬í˜„ ì™„ë£Œ
   - Email ê°’ ê°ì²´ êµ¬í˜„ ì™„ë£Œ  
   - Role, MemberStatus enum êµ¬í˜„ ì™„ë£Œ
   - íšŒì›ê°€ì…/ì¸ì¦/ìƒíƒœê´€ë¦¬ ë©”ì„œë“œ êµ¬í˜„ ì™„ë£Œ
   - ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‘ì„± ì™„ë£Œ

2. â³ **categories (ë‹¤ìŒ ë‹¨ê³„)**
3. â³ **prompts (ë‹¤ìŒ ë‹¨ê³„)**  
4. â³ **prompt_likes (ë‹¤ìŒ ë‹¨ê³„)**

### Phase 2 (í™•ì¥)
1. tags + prompt_tags
2. prompt_bookmarks
3. íŠ¸ë¦¬ê±° ë° ì„±ëŠ¥ ìµœì í™”

### Phase 3 (ê³ ë„í™”)
1. prompt_comments
2. prompt_versions
3. user_follows

## ğŸš€ í–¥í›„ í™•ì¥ í…Œì´ë¸”

### ì¶”í›„ ì¶”ê°€ ì˜ˆì • í…Œì´ë¸”
```sql
-- ëŒ“ê¸€ í…Œì´ë¸”
CREATE TABLE prompt_comments (
    id BIGSERIAL PRIMARY KEY,
    prompt_id BIGINT REFERENCES prompts(id) ON DELETE CASCADE,
    user_id BIGINT REFERENCES users(id) ON DELETE CASCADE,
    content TEXT NOT NULL,
    parent_id BIGINT REFERENCES prompt_comments(id), -- ëŒ€ëŒ“ê¸€
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- í”„ë¡¬í”„íŠ¸ íˆìŠ¤í† ë¦¬ í…Œì´ë¸” (ë²„ì „ ê´€ë¦¬)
CREATE TABLE prompt_versions (
    id BIGSERIAL PRIMARY KEY,
    prompt_id BIGINT REFERENCES prompts(id) ON DELETE CASCADE,
    version INTEGER NOT NULL,
    title VARCHAR(200),
    content TEXT,
    change_summary VARCHAR(500),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- ì‚¬ìš©ì íŒ”ë¡œìš° í…Œì´ë¸”
CREATE TABLE user_follows (
    follower_id BIGINT REFERENCES users(id) ON DELETE CASCADE,
    following_id BIGINT REFERENCES users(id) ON DELETE CASCADE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (follower_id, following_id)
);
```
