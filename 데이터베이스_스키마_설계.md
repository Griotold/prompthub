# 프롬프트허브(PromptHub) 데이터베이스 설계

## 📊 ERD 개요
```
users (사용자) 
  ↓ 1:N
prompts (프롬프트)
  ↓ N:1
categories (카테고리)

users ←→ prompts (N:M) via prompt_likes (좋아요)
users ←→ prompts (N:M) via prompt_bookmarks (북마크)
prompts ←→ tags (N:M) via prompt_tags (태그)
```

## 🗃️ 테이블 상세 설계

### 1. 카테고리
```
create table p_category
(
    id          bigint generated by default as identity
        primary key,
    createdat   timestamp(6),
    description text,
    isactive    boolean     not null,
    name        varchar(50) not null
        constraint uknu7gee55si4emj6suq55er2wv
            unique,
    updatedat   timestamp(6)
);

alter table p_category
    owner to spring;
```

### 2. 회원
```
create table p_member
(
    email_verified boolean      not null,
    deactivated_at timestamp(6),
    id             bigint generated by default as identity
        primary key,
    registered_at  timestamp(6),
    updated_at     timestamp(6),
    provider       varchar(20)
        constraint p_member_provider_check
            check ((provider)::text = ANY
                   ((ARRAY ['GOOGLE'::character varying, 'NAVER'::character varying, 'KAKAO'::character varying])::text[])),
    role           varchar(50)  not null
        constraint p_member_role_check
            check ((role)::text = ANY ((ARRAY ['USER'::character varying, 'ADMIN'::character varying])::text[])),
    status         varchar(50)  not null
        constraint p_member_status_check
            check ((status)::text = ANY
                   ((ARRAY ['ACTIVE'::character varying, 'DEACTIVATED'::character varying])::text[])),
    nickname       varchar(100) not null,
    provider_id    varchar(100),
    email_address  varchar(150) not null,
    password_hash  varchar(200),
    constraint uk_email_provider
        unique (email_address, provider)
);

alter table p_member
    owner to spring;
```

### 3. 프롬프트
```
create table p_prompt
(
    id             bigint generated by default as identity
        primary key,
    content        text         not null,
    createdat      timestamp(6),
    description    text,
    ispublic       boolean      not null,
    likescount     integer      not null default 0,
    title          varchar(200) not null,
    updatedat      timestamp(6),
    viewscount     integer      not null default 0,
    average_rating decimal(3,2) default 0.0,
    reviews_count  integer      default 0,
    category_id    bigint
        constraint fka16juxw5kxakt90ws8ogb4w7l
            references p_category,
    member_id      bigint
        constraint fkv8rkui4wse6rh8t01qw3po42
            references p_member(id)
);

alter table p_prompt
    owner to spring;
```

### 4. 프롬프트 - 좋아요
```
create table p_prompt_like
(
    id        bigint generated by default as identity
        primary key,
    createdat timestamp(6),
    member_id bigint
        constraint fk1uco9nk6vnd75otk7nwsb6flq
            references p_member(id),
    prompt_id bigint
        constraint fkptt5htv66nclb079dxlaohv1l
            references p_prompt(id),
    constraint uk3w6tqtrb6nu5bfocj0pwrpl9b
        unique (member_id, prompt_id)
);

alter table p_prompt_like
    owner to spring;
```

### 5. 태그
```
-- 태그 테이블
create table p_tag
(
    id        bigint generated by default as identity primary key,
    name      varchar(50) not null unique,
    createdat timestamp(6),
    isactive  boolean not null default true
);
```

### 6. 프롬프트 - 태그 연결 테이블
```
-- 프롬프트-태그 연결 테이블 (Many-to-Many)
create table p_prompt_tag
(
    id        bigint generated by default as identity primary key,
    prompt_id bigint not null references p_prompt(id),
    tag_id    bigint not null references p_tag(id),
    createdat timestamp(6),
    constraint uk_prompt_tag unique (prompt_id, tag_id)
);
```

### 7. 리뷰/평점 테이블
```
-- 리뷰 테이블 (평점 + 텍스트 리뷰 통합)
create table p_review
(
    id        bigint generated by default as identity primary key,
    prompt_id bigint not null references p_prompt(id),
    member_id bigint not null references p_member(id),
    rating    integer not null check (rating >= 1 and rating <= 5),
    content   text, -- 텍스트 리뷰 (선택사항)
    createdat timestamp(6),
    updatedat timestamp(6),
    constraint uk_member_prompt_review unique (member_id, prompt_id)
);
```